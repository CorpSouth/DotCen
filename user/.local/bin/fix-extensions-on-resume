#!/usr/bin/env bash

# We don't want multiple instances of the same exact script
pidof -x -o $$ "$(basename "$0")" && exit 1

# This fixes issues with misbehaving extensions on Cinnamon,
# particularly during resume from system sleep

dbus-monitor --session "type='signal',interface='org.cinnamon.ScreenSaver'" | \
(
  while true; do
    read -r X
    # If the screen is locked, please unset ALL extensions
    if echo "$X" | grep "boolean true" &> /dev/null ; then
      /usr/bin/gsettings reset org.cinnamon enabled-extensions ;
    # When the screen is unlocked, please enable the following extensions
    elif echo "$X" | grep "boolean false" &> /dev/null ; then
      /usr/bin/gsettings set org.cinnamon enabled-extensions "['opacify@anish.org', 'transparent-panels@germanfr', 'watermark@germanfr']" ;
    fi
  done
)
